{% extends 'layout.html' %}

{% load static %}

{% block head %}
<script>
    let inputValues = []
    document.addEventListener("DOMContentLoaded", () => {
        console.log("HEllo")
        // await sleep(1000);
        updateForm = document.getElementById("updateForm")
        inputs = updateForm.getElementsByTagName("input")
        options = updateForm.getElementsByTagName('option')
        sex = document.getElementById("gender").innerHTML
        for (let [key, element] of Object.entries(options)) {
            if (element.value == sex) {
                element.selected = true
            }
        }
        for (let [key, element] of Object.entries(inputs)) {
            if (element.type == "text" || element.type == "date") {
                inputValues.push(element.value)
            }
        }
        inputValues.push(sex)
    })
    function checkDifference(event) {
        event.preventDefault()
        checkValues = []
        updateForm = document.getElementById("updateForm")
        inputs = updateForm.getElementsByTagName("input")
        images = []
        for (let [key, element] of Object.entries(inputs)) {
            if (element.type == "text" || element.type == "date") {
                checkValues.push(element.value)
            }
            if (element.type == "file") {
                updateForm.submit()
                return true
            }
        }
        checkValues.push(document.getElementsByName('gender')[0].value)
        if (checkValues.length === inputValues.length && checkValues.every(function (value, index) { return value === inputValues[index] })) {
            alert("No new changes!")
        } else {
            updateForm.submit()
        }
    }
</script>
<link rel="stylesheet" type="text/css" href="{% static 'css/updatePage.css' %}">
{% endblock %}

{% block body %}
<div class="container">
    <h1>Upload documents</h1>
    <form action="{% url 'updatePage' passport_num %}" method="POST" onsubmit="checkDifference(event);" id="updateForm"
        enctype="multipart/form-data">
        {% csrf_token %}
        <div class="form-group">
            <input type="text" class="form-control" name="type" maxlength="1" pattern="[A-Z]{1}"
                placeholder="Enter type of passport" value="{{ passportInfo.ptype }}" required /><br>
        </div>
        <!--<div class="form-group">
            <input type="text" class="form-control" name="passNum" placeholder="Enter passport number" required/><br>

        </div>-->
        <div class="form-group">
            <input type="text" class="form-control" name="holderName" value="{{ personal_info.name }}"
                pattern="[A-Za-z]{1,50}" placeholder="Enter First name of passport holder" required /><br>

        </div>
        <div class="form-group">
            <input type="text" class="form-control" name="countryCode" value="{{ passportInfo.countryCode }}"
                pattern="[A-Za-z]{3}" placeholder="Enter country code of passport holder" required /><br>

        </div>
        <div class="form-group">
            <input type="text" class="form-control" name="nationality" value="{{ personal_info.nationality }}"
                pattern="[A-Za-z]{1,50}" placeholder="Enter nationality of passport holder" required /><br>

        </div>
        <div class="form-group">
            <input type="text" class="form-control" name="surname" value="{{ personal_info.surname }}"
                pattern="[A-Za-z]{1,50}" placeholder="Enter surname of passport holder" required /><br>

        </div>
        <p id="gender" style="display: none;">{{ personal_info.sex }}</p>
        <div class="form-group">
            <select name="gender" class="form-control">
                <option value="Male">Male</option>
                <option value="Female">Female</option>
                <option value="Others">Others</option>
            </select><br>

        </div>
        <div class="form-group">
            <input type="date" class="form-control" name="dob" value="{{ personal_info.dob }}"
                placeholder="Enter date of birth" required /><br>

        </div>
        <div class="form-group">
            <input type="text" class="form-control" name="placeOfBirth" value="{{ personal_info.placeOfBirth }}"
                pattern="[A-Za-z]{1,50}" placeholder="Enter place of birth" required /><br>

        </div>
        <div class="form-group">
            <input type="text" class="form-control" name="placeOfIssue" value="{{ passportInfo.placeOfIssue }}"
                pattern="[A-Za-z]{1,50}" placeholder="Enter place of issue of passport" required><br>

        </div>
        <div class="form-group">
            <input type="date" class="form-control" name="dateOfIssue" value="{{ passportInfo.dateOfIssue }}"
                placeholder="Enter date of issue of passport" required /><br>

        </div>
        <div class="form-group">
            <input type="date" class="form-control" name="dateOfExpiry" value="{{ passportInfo.dateOfExpiry }}"
                placeholder="Enter date of expiry of passport" required /><br>

        </div>


        <div class="form-group">
            <input type="text" class="form-control" name="father" value="{{ personal_info.father }}"
                pattern="[A-Za-z]{1,50}" placeholder="Enter father's name" required /><br>

        </div>
        <div class="form-group">
            <input type="text" class="form-control" name="mother" value="{{ personal_info.mother }}"
                pattern="[A-Za-z]{1,50}" placeholder="Enter mother's name" required /><br>

        </div>
        <div class="form-group">
            <input type="text" class="form-control" name="spouse" value="{{ personal_info.spouse }}"
                pattern="[A-Za-z]{0,50}" placeholder="Enter spouse's name (optional)" /><br>
        </div>
        <div class="form-group">
            <input type="text" class="form-control" name="address_1" value="{{ personal_info.currentAddress.0 }}"
                pattern="[A-Za-z0-9'\.\-\s\,]{1,50}" placeholder="Address Line 1" required /><br>
        </div>
        <div class="form-group">
            <input type="text" class="form-control" name="address_2" value="{{ personal_info.currentAddress.1 }}"
                pattern="[A-Za-z0-9'\.\-\s\,]{1,50}" placeholder="Address Line 2" required /><br>
        </div>
        <div class="form-group">
            <input type="text" class="form-control" name="address_3" value="{{ personal_info.currentAddress.2 }}"
                pattern="[A-Za-z0-9'\.\-\s\,]{1,50}" placeholder="Address Line 3" required /><br>
        </div>
        <div class="form-group">
            <input type="text" class="form-control" name="address_4" value="{{ personal_info.currentAddress.3 }}"
                pattern="[A-Za-z0-9'\.\-\s\,]{0,50}" placeholder="Address Line 4(optional)" /><br>
        </div>
        <div class="form-group">
            <input type="text" class="form-control" name="oldPassNum"
                value="{{ passportInfo.oldPassNumDateAndIssue.0 }}"
                placeholder="Enter previous passport number(optional)" /><br>
        </div>
        <div class="form-group">
            <input type="text" class="form-control" name="oldPlaceIssue"
                value="{{ passportInfo.oldPassNumDateAndIssue.2 }}" pattern="[A-Za-z]{1,50}"
                placeholder="Enter place of issue of previous passport(optional)" /><br>
        </div>
        <div class="form-group">
            <input type="date" class="form-control" name="oldDateIssue"
                value="{{ passportInfo.oldPassNumDateAndIssue.1 }}" pattern="[A-Za-z]{1,50}"
                placeholder="Enter date of issue of previous passport(optional)" /><br>
        </div>
        <div class="form-group">
            <input type="text" class="form-control" name="fileNum" value="{{ passportInfo.fileNum }}"
                placeholder="Enter file number" /><br>
        </div>
        <div class="form-group">
            <input type="file" class="form-control" name="faceId" placeholder="Upload photo"
                accept="image/jpeg, image/png" /><br>
            <img src="data:image/png;base64,{{ images.0 }}" alt="Ipfs image" id="face-photo" />

        </div>
        <div class="form-group">
            <input type="file" class="form-control" name="sign" placeholder="Upload signature"
                value="data:image/png;base64,{{ images.1 }}" accept="image/jpeg, image/png" /><br>
            <img src="data:image/png;base64,{{ images.1 }}" alt="Ipfs image" id="sign-photo" />

        </div>

        <div class="form-group">
            <input type="submit" class="btn btn-primary" value="Submit">
        </div>
    </form>
</div>
{% endblock %}
